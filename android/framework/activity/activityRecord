/**************************
 ActivityRecord

*/

enum ActivityState {
        INITIALIZING,
        RESUMED,
        PAUSING,
        PAUSED,
        STOPPING,
        STOPPED,
        FINISHING,
        DESTROYING,
        DESTROYED
    }

//INITIALIZING
ActivityRecord(ActivityManagerService _service, Intent _intent,ActivityInfo aInfo,....) {
- ActivityManagerService service = _service;
- IApplicationToken.Stub  appToken = new Token(this);
- info = aInfo;
- state = INITIALIZING;
}@ActivityRecord.java

//创建controller
createWindowContainer(){
- TaskWindowContainerController taskController = task.getWindowContainerController()
- updateOverrideConfiguration
- mWindowContainerController = new AppWindowContainerController(taskController, appToken...)
}@ActivityRecord.java

//设置启动窗口
showStartingWindow(ActivityRecord prev, boolean newTask, boolean taskSwitch, boolean fromRecents){
- CompatibilityInfo compatInfo = service.compatibilityInfoForPackageLocked
- boolean shown = mWindowContainerController.addStartingWindow(packageName, theme,
	compatInfo, nonLocalizedLabel, labelRes, icon, logo...)
- 
}@ActivityRecord.java

//设置可见.AppWindowTokenController-->AppWindowToken-->WindowState-->(应用进程)ViewRootImpl
setVisibility(boolean visible){
- mWindowContainerController.setVisibility-->setVisibility@AppWindowTokenController.java
}@ActivityRecord.java


onWindowsVisible{
- nowVisible = true
- if (idle || mStackSupervisor.isStoppingNoHistoryActivity()) {	//有其它activity等待当前activity可见
	- mStackSupervisor.mActivitiesWaitingForVisibleActivity.clear()
	- mStackSupervisor.scheduleIdleLocked(
  }else{
	- mStackSupervisor.processStoppingActivitiesLocked
  }
}ActivityRecord.java

//finishing:
makeFinishing{
- finishing = true
- 任务中的activity个数减1，task.numActivities--
- 若已经stoped，清除没有处理的操作
}


//通知应用端进入分屏模式
onConfigurationChanged@TaskRecord.java-->scheduleUpdateMultiWindowMode-->
mHandler.sendEmptyMessage(REPORT_MULTI_WINDOW_MODE_CHANGED_MSG)@ActivityStackSupervisor.java-->
updateMultiWindowMode{
- mLastReportedMultiWindowMode = inMultiWindowMode
- scheduleMultiWindowModeChanged(getConfiguration())
}@ActivityRecord.java

frameworks/base/services/core/java/com/android/server/am/ActivityRecord.java
frameworks/base/services/core/java/com/android/server/wm/AppWindowContainerController.java
